!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).immutableJSONPatch={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e){return Array.isArray(e)}function h(e){return null!==e&&"object"===t(e)&&e.constructor===Object}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){return e===t}function n(e){return e.slice(0,e.length-1)}function o(e){return"object"===r(e)&&null!==e}function i(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function c(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?i(Object(o),!0).forEach(function(e){var t,r;t=n,r=o[e=e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function d(t){var r,n;return y(t)?(r=t.slice(),Object.getOwnPropertySymbols(t).forEach(function(e){r[e]=t[e]}),r):h(t)?(n=c({},t),Object.getOwnPropertySymbols(t).forEach(function(e){n[e]=t[e]}),n):t}function a(e,t,r){return e[t]===r?e:((e=d(e))[t]=r,e)}function b(e,t){for(var r=e,n=0;n<t.length;)r=h(r)?r[t[n]]:y(r)?r[parseInt(t[n])]:void 0,n++;return r}function m(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(0===t.length)return r;var o=t[0],t=m(e?e[o]:void 0,t.slice(1),r,n);if(h(e)||y(e))return a(e,o,t);if(n)return(r=u.test(o)?[]:{})[o]=t,r;throw new Error("Path does not exist")}var u=/^\d+$/;function p(e,t,r){if(0===t.length)return r(e);var n;if(o(e))return a(e,n=t[0],p(e[n],t.slice(1),r));throw new Error("Path doesn't exist")}function g(e,t){if(0===t.length)return e;var r,n;if(o(e))return 1===t.length?(n=t[0])in e?(y(r=d(e))&&r.splice(parseInt(n),1),h(r)&&delete r[n],r):e:a(e,n=t[0],g(e[n],t.slice(1)));throw new Error("Path does not exist")}function O(e,t,r){var n=t.slice(0,t.length-1),o=t[t.length-1];return p(e,n,function(e){if(Array.isArray(e))return(e=d(e)).splice(parseInt(o),0,r),e;throw new TypeError("Array expected at path "+JSON.stringify(n))})}function S(e,t){return void 0!==e&&(0===t.length||null!==e&&S(e[t[0]],t.slice(1)))}function l(e){e=e.split("/");return e.shift(),e.map(function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")})}function w(e){return e.map(s).join("")}function s(e){return"/"+String(e).replace(/~/g,"~0").replace(/\//g,"~1")}function v(e,t,r){for(var n,o,i,c,f,a,u=e,p=0;p<t.length;p++){l=void 0;var l=t[p];if(!["add","remove","replace","copy","move","test"].includes(l.op))throw new Error("Unknown JSONPatch op "+JSON.stringify(l.op));if("string"!=typeof l.path)throw new Error('Required property "path" missing or not a string in operation '+JSON.stringify(l));if(("copy"===l.op||"move"===l.op)&&"string"!=typeof l.from)throw new Error('Required property "from" missing or not a string in operation '+JSON.stringify(l));l=t[p];if(r&&r.before){var s=r.before(u,l);if(void 0!==s){if(void 0!==s.document&&(u=s.document),void 0!==s.json)throw new Error('Deprecation warning: returned object property ".json" has been renamed to ".document"');void 0!==s.operation&&(l=s.operation)}}var s=u,y=P(u,l.path);if("add"===l.op)c=u,f=y,a=l.value,u=(j(c,f)?O:m)(c,f,a);else if("remove"===l.op)u=g(u,y);else if("replace"===l.op)c=u,f=l.value,u=m(c,y,f);else if("copy"===l.op)a=u,n=y,o=J(l.from),i=void 0,i=b(a,o),u=j(a,n)?O(a,n,i):(i=b(a,o),m(a,n,i));else if("move"===l.op)o=u,n=y,i=J(l.from),h=void 0,h=b(o,i),u=(j(o=g(o,i),n)?O:m)(o,n,h);else{if("test"!==l.op)throw new Error("Unknown JSONPatch operation "+JSON.stringify(l));v=d=h=void 0;var h=u,d=y,v=l.value;if(void 0===v)throw new Error('Test failed: no value provided (path: "'.concat(w(d),'")'));if(!S(h,d))throw new Error('Test failed: path not found (path: "'.concat(w(d),'")'));if(!function(e,t){return JSON.stringify(e)===JSON.stringify(t)}(b(h,d),v))throw new Error('Test failed, value differs (path: "'.concat(w(d),'")'))}r&&r.after&&void 0!==(y=r.after(u,l,s))&&(u=y)}return u}function j(e,t){if(0!==t.length)return e=b(e,n(t)),Array.isArray(e)}function P(e,t){return e=e,"-"!==(t=l(t))[t.length-1]?t:(t=b(e,e=n(t)),e.concat(t.length))}function J(e){return l(e)}function N(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var r;if(e)return"string"==typeof e?E(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A(e,t){return[{op:"replace",path:w(t),value:b(e,t)}]}function I(e,t){return[{op:"add",path:w(t),value:b(e,t)}]}function T(e,t){return j(e,t)||!S(e,t)?[{op:"remove",path:w(t)}]:A(e,t)}e.appendToJSONPointer=function(e,t){return e+s(t)},e.compileJSONPointer=w,e.compileJSONPointerProp=s,e.deleteIn=g,e.existsIn=S,e.getIn=b,e.immutableJSONPatch=v,e.insertAt=O,e.isJSONArray=y,e.isJSONObject=h,e.isJSONPatchAdd=function(e){return!(!e||"object"!==t(e))&&"add"===e.op},e.isJSONPatchCopy=function(e){return!(!e||"object"!==t(e))&&"copy"===e.op},e.isJSONPatchMove=function(e){return!(!e||"object"!==t(e))&&"move"===e.op},e.isJSONPatchOperation=function(e){return!(!e||"object"!==t(e))&&"string"==typeof e.op},e.isJSONPatchRemove=function(e){return!(!e||"object"!==t(e))&&"remove"===e.op},e.isJSONPatchReplace=function(e){return!(!e||"object"!==t(e))&&"replace"===e.op},e.isJSONPatchTest=function(e){return!(!e||"object"!==t(e))&&"test"===e.op},e.parseFrom=J,e.parseJSONPointer=l,e.parsePath=P,e.revertJSONPatch=function(e,t,i){var c=[];return v(e,t,{before:function(e,t){var r,n,o=P(e,t.path);if("add"===t.op)r=T(e,o);else if("remove"===t.op)r=I(e,o);else if("replace"===t.op)r=A(e,o);else if("copy"===t.op)r=T(e,o);else if("move"===t.op)r=function(e,t,r){if(t.length<r.length&&function(e,t,r){var n=2<arguments.length&&void 0!==r?r:f;if(!(e.length<t.length)){for(var o=0;o<t.length;o++)if(!n(e[o],t[o]))return;return 1}}(r,t))return[{op:"replace",path:w(t),value:e}];r={op:"move",from:w(t),path:w(r)};return!j(e,t)&&S(e,t)?[r].concat(N(I(e,t))):[r]}(e,o,J(t.from));else{if("test"!==t.op)throw new Error("Unknown JSONPatch operation "+JSON.stringify(t));r=[]}if(i&&i.before){o=i.before(e,t,r);if(o&&o.revertOperations&&(r=o.revertOperations),o&&o.document&&(n=o.document),o&&o.json)throw new Error('Deprecation warning: returned object property ".json" has been renamed to ".document"')}if(c=r.concat(c),void 0!==n)return{document:n}}}),c},e.setIn=m,e.startsWithJSONPointer=function(e,t){return e.startsWith(t)&&(e.length===t.length||"/"===e[t.length])},e.transform=function e(t,r){var n,o,i,c,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=r(t,f);if(y(a)){for(var u,p=0;p<a.length;p++){var l=a[p],s=e(l,r,f.concat(p+""));s!==l&&((u=u||d(a))[p]=s)}return u||a}if(h(a)){for(o in a)Object.hasOwnProperty.call(a,o)&&(c=e(i=a[o],r,f.concat(o)))!==i&&((n=n||d(a))[o]=c);return n||a}return a},e.updateIn=p,Object.defineProperty(e,"__esModule",{value:!0})});